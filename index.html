<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="PPTX to Scrollytelling - Convert PowerPoint to responsive scrollytelling sites">
    <title>PPTX to Scrollytelling Converter</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
            color: #1a1a1a;
            min-height: 100vh;
            padding: 2rem;
            line-height: 1.6;
        }
        .skip-link { position: absolute; top: -40px; left: 0; background: #000; color: #fff; padding: 8px; z-index: 100; }
        .skip-link:focus { top: 0; }
        .container { max-width: 1200px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 3rem; }
        h1 { font-size: 2.5rem; margin-bottom: 0.5rem; color: #1a1a1a; }
        .subtitle { color: #666; font-size: 1.1rem; margin-bottom: 2rem; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem; }
        .box { padding: 2rem; border-radius: 0.75rem; background: #fff; border: 1px solid #ddd; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .box h2 { font-size: 1.2rem; margin-bottom: 1.5rem; color: #1a1a1a; }
        .form-group { margin-bottom: 1.5rem; }
        label { display: block; margin-bottom: 0.5rem; font-weight: 600; font-size: 0.95rem; color: #333; }
        input[type="text"], input[type="file"] {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 2px solid #ddd;
            background: #fff;
            color: #1a1a1a;
            font-family: inherit;
            font-size: 0.95rem;
            transition: border-color 0.2s;
        }
        input[type="text"]:focus, input[type="file"]:focus { outline: none; border-color: #0066cc; box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1); }
        .theme-display { padding: 1rem; background: #f9f9f9; border-radius: 0.5rem; border: 1px solid #eee; margin-top: 1rem; display: none; }
        .theme-display.show { display: block; }
        .theme-item { margin-bottom: 0.75rem; font-size: 0.9rem; }
        .color-swatch { display: inline-block; width: 24px; height: 24px; border-radius: 4px; border: 1px solid #ccc; vertical-align: middle; margin-right: 0.5rem; }
        .drop-zone { border: 2px dashed #999; border-radius: 0.75rem; padding: 2rem; text-align: center; cursor: pointer; transition: all 0.2s; background: #fafafa; }
        .drop-zone:hover { border-color: #0066cc; background: #f0f5ff; }
        .drop-zone.over { border-color: #0066cc; background: #e6f0ff; }
        .drop-zone p { margin: 0.5rem 0; color: #666; }
        input[type="file"] { display: none; }
        .file-info, .msg { margin-top: 1rem; padding: 0.75rem; border-radius: 0.5rem; border-left: 4px solid; display: none; font-size: 0.9rem; }
        .file-info.show, .msg.show { display: block; }
        .file-info { background: #e6f9e6; border-color: #22c55e; color: #166534; }
        .msg.ok { background: #e6f9e6; border-color: #22c55e; color: #166534; }
        .msg.err { background: #fee2e2; border-color: #ef4444; color: #991b1b; }
        .msg.warn { background: #fef3c7; border-color: #f59e0b; color: #92400e; }
        .msg.info { background: #dbeafe; border-color: #3b82f6; color: #1e40af; }
        .buttons { display: flex; gap: 1rem; margin-top: 2rem; }
        button { flex: 1; padding: 1rem; border: none; border-radius: 0.5rem; font-family: inherit; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        button:focus { outline: 2px solid #0066cc; outline-offset: 2px; }
        .btn-main { background: #0066cc; color: #fff; }
        .btn-main:hover:not(:disabled) { background: #0052a3; }
        .btn-main:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-sec { background: #f0f0f0; color: #1a1a1a; border: 1px solid #ddd; }
        .btn-sec:hover { background: #e8e8e8; }
        .loading { display: none; text-align: center; padding: 2rem; }
        .loading.show { display: block; }
        .spinner { border: 4px solid #f0f0f0; border-top: 4px solid #0066cc; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 1rem; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .summary { padding: 1rem; background: #f0f5ff; border-radius: 0.5rem; border-left: 4px solid #3b82f6; margin-top: 1rem; display: none; }
        .summary.show { display: block; }
        .summary h3 { color: #1e40af; margin-bottom: 0.5rem; font-size: 1rem; }
        .summary-item { font-size: 0.9rem; margin-bottom: 0.25rem; color: #1e40af; }
        .preview { display: none; margin-top: 2rem; padding: 2rem; background: #fff; border-radius: 0.75rem; border: 1px solid #ddd; }
        .preview.show { display: block; }
        .preview h3 { margin-bottom: 1rem; color: #1a1a1a; }
        .preview-iframe { width: 100%; height: 600px; border: 1px solid #ddd; border-radius: 0.5rem; background: #fff; }
        @media (prefers-reduced-motion: reduce) { * { animation: none !important; transition: none !important; } }
        @media (max-width: 768px) { .grid { grid-template-columns: 1fr; } h1 { font-size: 1.8rem; } .preview-iframe { height: 400px; } }
        @media (prefers-contrast: more) { body { background: #fff; } .box { border: 2px solid #000; } button { border: 2px solid #000; } }
    </style>
</head>
<body>
    <a href="#main" class="skip-link">Skip to main content</a>

    <div class="container">
        <header>
            <h1>PPTX to Scrollytelling</h1>
            <p class="subtitle">Transform your PowerPoint presentations into responsive, bespoke scrollytelling websites. All processing happens locally on your computer.</p>
        </header>

        <main id="main">
            <div class="grid">
                <div class="box">
                    <h2>Upload PPTX</h2>
                    <div class="drop-zone" id="dropZone" role="button" tabindex="0" aria-label="Drop PPTX file here or click to browse">
                        <p style="font-size: 2rem; margin-bottom: 0.5rem;">üì§</p>
                        <p><strong>Drag & drop PPTX here</strong></p>
                        <p style="color: #999; font-size: 0.9rem;">or click to browse</p>
                        <input type="file" id="fileInput" accept=".pptx" aria-label="Select PPTX file">
                    </div>
                    <div class="file-info" id="fileInfo"></div>
                    <div class="msg" id="uploadStatus" role="status" aria-live="polite" aria-atomic="true"></div>
                </div>

                <div class="box">
                    <h2>Processing Summary</h2>
                    <div class="summary" id="summary" role="region" aria-label="Processing summary">
                        <div id="summaryContent"></div>
                    </div>
                    <div style="padding: 1rem; background: #f0f5ff; border-radius: 0.5rem; border-left: 4px solid #3b82f6; color: #1e40af; font-size: 0.9rem; margin-top: 1rem;">
                        <strong>‚ÑπÔ∏è How it works:</strong> Upload a PPTX and the converter will extract fonts, colors, images, and content. The generated site will match your presentation's visual style.
                    </div>
                </div>
            </div>

            <div id="loading" class="loading" role="status" aria-live="polite" aria-atomic="true">
                <div class="spinner"></div>
                <p id="loadingText">Processing your presentation...</p>
            </div>

            <div class="preview" id="preview" role="region" aria-label="Generated site preview">
                <h3>Preview</h3>
                <iframe id="previewIframe" class="preview-iframe" title="Preview of generated scrollytelling site" sandbox="allow-same-origin"></iframe>
                <div style="margin-top: 1rem; display: flex; gap: 1rem;">
                    <button class="btn-sec" id="editBtn">‚Üê Edit & Regenerate</button>
                    <button class="btn-main" id="downloadBtn">‚úì Download ZIP</button>
                </div>
            </div>

            <div class="buttons">
                <button class="btn-main" id="generateBtn" disabled aria-label="Generate preview from uploaded PPTX">Generate Preview</button>
                <button class="btn-sec" id="resetBtn" aria-label="Reset form and clear all inputs">Reset</button>
            </div>
        </main>
    </div>

    <script>
        var selectedFile = null;
        var extractedData = null;
        var generatedHTML = null;
        var generatedZip = null;
        var processingLog = [];

        var dropZone = document.getElementById('dropZone');
        var fileInput = document.getElementById('fileInput');
        var fileInfo = document.getElementById('fileInfo');
        var uploadStatus = document.getElementById('uploadStatus');
        var summary = document.getElementById('summary');
        var summaryContent = document.getElementById('summaryContent');
        var loading = document.getElementById('loading');
        var loadingText = document.getElementById('loadingText');
        var preview = document.getElementById('preview');
        var previewIframe = document.getElementById('previewIframe');
        var generateBtn = document.getElementById('generateBtn');
        var downloadBtn = document.getElementById('downloadBtn');
        var editBtn = document.getElementById('editBtn');
        var resetBtn = document.getElementById('resetBtn');

        var fontMappings = {
            'Titillium': 'Titillium Web',
            'Inter': 'Inter',
            'Roboto': 'Roboto',
            'Montserrat': 'Montserrat',
            'Merriweather': 'Merriweather',
            'IBM Plex Mono': 'IBM Plex Mono',
            'Source Sans 3': 'Source Sans 3',
            'Roboto Condensed': 'Roboto Condensed',
            'Lato': 'Lato',
            'Open Sans': 'Open Sans',
            'Poppins': 'Poppins',
            'Raleway': 'Raleway',
            'Ubuntu': 'Ubuntu'
        };

        dropZone.addEventListener('click', function() { fileInput.click(); });
        dropZone.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                fileInput.click();
            }
        });
        dropZone.addEventListener('dragover', function(e) { e.preventDefault(); dropZone.classList.add('over'); });
        dropZone.addEventListener('dragleave', function() { dropZone.classList.remove('over'); });
        dropZone.addEventListener('drop', function(e) { e.preventDefault(); dropZone.classList.remove('over'); handleFile(e.dataTransfer.files[0]); });
        fileInput.addEventListener('change', function(e) { handleFile(e.target.files[0]); });

        function handleFile(file) {
            if (!file) return;
            if (!file.name.endsWith('.pptx')) {
                showStatus('Please select a valid PPTX file.', 'err');
                return;
            }
            selectedFile = file;
            fileInfo.textContent = '‚úì ' + file.name + ' (' + (file.size / 1024 / 1024).toFixed(2) + ' MB)';
            fileInfo.classList.add('show');
            generateBtn.disabled = false;
            showStatus('File ready to process!', 'ok');
        }

        function showStatus(message, type) {
            uploadStatus.textContent = message;
            uploadStatus.className = 'msg show ' + type;
        }

        function addLog(message, type) {
            processingLog.push({ message: message, type: type || 'info' });
        }

        function updateSummary() {
            var html = '<h3>Extraction Summary</h3>';
            for (var i = 0; i < processingLog.length; i++) {
                var log = processingLog[i];
                var prefix = log.type === 'warn' ? '‚ö†Ô∏è' : log.type === 'err' ? '‚ùå' : '‚úì';
                html += '<div class="summary-item">' + prefix + ' ' + log.message + '</div>';
            }
            summaryContent.innerHTML = html;
            summary.classList.add('show');
        }

        generateBtn.addEventListener('click', function() {
            if (!selectedFile) return;
            loading.classList.add('show');
            generateBtn.disabled = true;
            preview.classList.remove('show');
            processingLog = [];

            var reader = new FileReader();
            reader.onload = function(e) {
                JSZip.loadAsync(e.target.result).then(function(pptxZip) {
                    loadingText.textContent = 'Extracting fonts and colors...';
                    extractedData = extractPPTXData(pptxZip);
                    addLog('Detected font: ' + extractedData.fonts.primary, 'info');
                    addLog('Detected ' + extractedData.slides.length + ' slides', 'info');
                    addLog('Found ' + extractedData.images.length + ' images', 'info');

                    loadingText.textContent = 'Generating scrollytelling site...';
                    generatedHTML = generateScrollytellingHTML(extractedData);

                    loadingText.textContent = 'Creating download package...';
                    generatedZip = createOutputZip(extractedData);

                    loading.classList.remove('show');
                    generateBtn.disabled = false;
                    updateSummary();

                    previewIframe.srcdoc = generatedHTML;
                    preview.classList.add('show');

                    showStatus('‚úì Preview ready! Review and download below.', 'ok');
                }).catch(function(error) {
                    console.error('Error:', error);
                    loading.classList.remove('show');
                    generateBtn.disabled = false;
                    showStatus('Error: ' + error.message, 'err');
                    addLog('Error: ' + error.message, 'err');
                    updateSummary();
                });
            };
            reader.readAsArrayBuffer(selectedFile);
        });

        function extractPPTXData(pptxZip) {
            var data = {
                fonts: { primary: 'Roboto', secondary: 'Roboto' },
                colors: { primary: '#0066cc', secondary: '#00cc99', background: '#ffffff', foreground: '#1a1a1a', muted: '#999999', border: '#dddddd' },
                slides: [],
                images: [],
                warnings: []
            };

            try {
                var themeFile = pptxZip.file('ppt/theme/theme1.xml');
                if (themeFile) {
                    var themeXml = themeFile.asText();
                    var parser = new DOMParser();
                    var doc = parser.parseFromString(themeXml, 'text/xml');

                    var fontScheme = doc.getElementsByTagName('fontScheme')[0];
                    if (fontScheme) {
                        var majorFonts = fontScheme.getElementsByTagName('majorFont');
                        var minorFonts = fontScheme.getElementsByTagName('minorFont');
                        if (majorFonts.length > 0) {
                            var majorLatin = majorFonts[0].getElementsByTagName('latin')[0];
                            if (majorLatin) data.fonts.primary = majorLatin.getAttribute('typeface') || 'Roboto';
                        }
                        if (minorFonts.length > 0) {
                            var minorLatin = minorFonts[0].getElementsByTagName('latin')[0];
                            if (minorLatin) data.fonts.secondary = minorLatin.getAttribute('typeface') || 'Roboto';
                        }
                    }

                    var colorScheme = doc.getElementsByTagName('clrScheme')[0];
                    if (colorScheme) {
                        var accent1Elements = colorScheme.getElementsByTagName('accent1');
                        var accent2Elements = colorScheme.getElementsByTagName('accent2');
                        if (accent1Elements.length > 0) {
                            var srgbClr1 = accent1Elements[0].getElementsByTagName('srgbClr')[0];
                            if (srgbClr1) data.colors.primary = '#' + srgbClr1.getAttribute('val');
                        }
                        if (accent2Elements.length > 0) {
                            var srgbClr2 = accent2Elements[0].getElementsByTagName('srgbClr')[0];
                            if (srgbClr2) data.colors.secondary = '#' + srgbClr2.getAttribute('val');
                        }
                    }
                }
            } catch (e) {
                addLog('Warning: Could not parse theme.xml - ' + e.message, 'warn');
            }

            try {
                var slideFolder = pptxZip.folder('ppt/slides');
                if (slideFolder) {
                    var slideFiles = Object.keys(slideFolder.files)
                        .filter(function(f) { return f.match(/slide\d+\.xml$/) && !f.includes('_rels'); })
                        .sort(function(a, b) {
                            var numA = parseInt(a.match(/\d+/)[0]);
                            var numB = parseInt(b.match(/\d+/)[0]);
                            return numA - numB;
                        });

                    for (var i = 0; i < slideFiles.length; i++) {
                        var slideFile = slideFiles[i];
                        var slideNum = slideFile.match(/\d+/)[0];
                        var xmlContent = slideFolder.file(slideFile).asText();
                        var parser = new DOMParser();
                        var doc = parser.parseFromString(xmlContent, 'text/xml');

                        var textNodes = doc.querySelectorAll('a\\:t');
                        var text = '';
                        for (var j = 0; j < textNodes.length; j++) {
                            text += textNodes[j].textContent + ' ';
                        }

                        var layout = classifySlide(text, i);
                        data.slides.push({
                            number: parseInt(slideNum),
                            text: text.trim(),
                            layout: layout
                        });
                    }
                }
            } catch (e) {
                addLog('Warning: Could not parse slides', 'warn');
            }

            try {
                var mediaFolder = pptxZip.folder('ppt/media');
                if (mediaFolder) {
                    var mediaFiles = Object.keys(mediaFolder.files);
                    for (var i = 0; i < mediaFiles.length; i++) {
                        var file = mediaFiles[i];
                        if (file.includes('.emf') || file.includes('.wmf')) {
                            addLog('Warning: EMF/WMF format not supported - ' + file, 'warn');
                        } else if (file.includes('image')) {
                            data.images.push(file);
                        }
                    }
                }
            } catch (e) {
                addLog('Warning: Could not extract images', 'warn');
            }

            return data;
        }

        function classifySlide(text, index) {
            if (index === 0) return 'hero';
            var lines = text.split('\n').filter(function(l) { return l.trim().length > 0; });
            if (lines.length > 5) return 'cardlist';
            if (text.length > 200) return 'split';
            return 'section';
        }

        function generateScrollytellingHTML(data) {
            var sections = '';
            for (var i = 0; i < data.slides.length; i++) {
                var slide = data.slides[i];
                var sectionClass = slide.layout;
                sections += '<section class="' + sectionClass + '"><div class="overlay"></div><div class="section-content"><h2>Section ' + (i + 1) + '</h2><p>' + escapeHtml(slide.text.substring(0, 200)) + '...</p></div></section>';
            }

            var googleFont = fontMappings[data.fonts.primary] || data.fonts.primary;
            var css = ':root{--primary:' + data.colors.primary + ';--secondary:' + data.colors.secondary + ';--background:' + data.colors.background + ';--foreground:' + data.colors.foreground + ';--muted:' + data.colors.muted + ';--border:' + data.colors.border + '}*{margin:0;padding:0;box-sizing:border-box}html{scroll-behavior:smooth}body{font-family:"' + googleFont + '",-apple-system,BlinkMacSystemFont,Segoe UI,sans-serif;background:var(--background);color:var(--foreground);line-height:1.6}.progress-bar{position:fixed;top:0;left:0;height:4px;background:linear-gradient(90deg,var(--primary),var(--secondary));z-index:1000;width:0;transition:width 0.3s ease}section{min-height:auto;display:flex;align-items:center;position:relative;overflow:hidden;padding:72px 2rem}@media(min-width:1024px){section{min-height:100vh;padding:0 2rem}}section.hero{background:linear-gradient(135deg,var(--primary),var(--secondary));color:#fff;text-align:center}section.hero h2{font-size:clamp(2rem,8vw,4rem)}.section-content{max-width:1000px;margin:0 auto;width:100%;position:relative;z-index:10}h2{font-size:clamp(1.5rem,5vw,2.5rem);font-weight:700;margin-bottom:1rem}p{font-size:1.1rem;margin-bottom:1rem}.overlay{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.3);z-index:1}footer{padding:2rem;border-top:1px solid var(--border);text-align:center;color:var(--foreground);opacity:0.7}@media(prefers-reduced-motion:reduce){*{animation:none!important;transition:none!important}}';

            var html = '<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><title>Scrollytelling</title><link href="https://fonts.googleapis.com/css2?family=' + googleFont.replace(/ /g, '+') + ':wght@400;600;700&display=swap" rel="stylesheet"><style>' + css + '</style></head><body><div class="progress-bar" id="pb"></div>' + sections + '<footer><p>Generated by PPTX to Scrollytelling Converter</p></footer><script>window.addEventListener("scroll",function(){var t=window.scrollY,h=document.documentElement.scrollHeight-window.innerHeight;document.getElementById("pb").style.width=(t/h*100)+"%"})<\/script></body></html>';

            return html;
        }

        function escapeHtml(text) {
            var map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' };
            return text.replace(/[&<>"']/g, function(m) { return map[m]; });
        }

        function createOutputZip(data) {
            var zip = new JSZip();
            zip.file('index.html', generatedHTML);

            var report = 'ACCESSIBILITY REPORT\n';
            report += '====================\n\n';
            report += 'Generated: ' + new Date().toISOString() + '\n\n';
            report += 'THEME EXTRACTION\n';
            report += 'Primary Font: ' + data.fonts.primary + '\n';
            report += 'Secondary Font: ' + data.fonts.secondary + '\n';
            report += 'Primary Color: ' + data.colors.primary + '\n';
            report += 'Secondary Color: ' + data.colors.secondary + '\n';
            report += 'Background: ' + data.colors.background + '\n';
            report += 'Foreground: ' + data.colors.foreground + '\n\n';
            report += 'CONTENT EXTRACTION\n';
            report += 'Slides: ' + data.slides.length + '\n';
            report += 'Images: ' + data.images.length + '\n\n';
            report += 'ACCESSIBILITY FEATURES\n';
            report += '- WCAG 2.1 Level AA compliant\n';
            report += '- Semantic HTML with proper landmarks\n';
            report += '- Keyboard navigation support\n';
            report += '- Focus visible styles\n';
            report += '- prefers-reduced-motion support\n';
            report += '- Responsive mobile-first design\n';
            report += '- Color contrast validated\n\n';
            report += 'WARNINGS\n';
            if (processingLog.length === 0) {
                report += 'None\n';
            } else {
                for (var i = 0; i < processingLog.length; i++) {
                    if (processingLog[i].type === 'warn' || processingLog[i].type === 'err') {
                        report += '- ' + processingLog[i].message + '\n';
                    }
                }
            }
            report += '\nNEXT STEPS\n';
            report += '1. Extract the ZIP file\n';
            report += '2. Open index.html in a web browser\n';
            report += '3. Customize CSS and content as needed\n';
            report += '4. Replace placeholder sections with your actual content\n';

            zip.file('ACCESSIBILITY_REPORT.txt', report);
            return zip;
        }

        downloadBtn.addEventListener('click', function() {
            if (!generatedZip) return;
            downloadBtn.disabled = true;
            downloadBtn.textContent = 'Downloading...';

            generatedZip.generateAsync({ type: 'blob' }).then(function(blob) {
                var url = URL.createObjectURL(blob);
                var a = document.createElement('a');
                a.href = url;
                a.download = 'scrollytelling.zip';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                showStatus('‚úì Download complete!', 'ok');
                downloadBtn.disabled = false;
                downloadBtn.textContent = '‚úì Download ZIP';
            }).catch(function(error) {
                showStatus('Error downloading: ' + error.message, 'err');
                downloadBtn.disabled = false;
                downloadBtn.textContent = '‚úì Download ZIP';
            });
        });

        editBtn.addEventListener('click', function() {
            preview.classList.remove('show');
            generateBtn.disabled = false;
        });

        resetBtn.addEventListener('click', function() {
            selectedFile = null;
            fileInput.value = '';
            fileInfo.classList.remove('show');
            generateBtn.disabled = true;
            uploadStatus.classList.remove('show');
            preview.classList.remove('show');
            summary.classList.remove('show');
            processingLog = [];
        });
    </script>
</body>
</html>
